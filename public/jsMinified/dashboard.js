var messageCount=0;let getMessageDebounce=!0;const msgElement=document.querySelector(".logs-item_template"),dialogElements=document.querySelectorAll(".viewDialog");function fetchMessages(e,t){if(!e||void 0==t||e>=25||t<=-1){console.log("bad data (client)");return}return fetch("profile/getMessage",{method:"post",credentials:"include",headers:{"Content-Type":"application/json"},body:`{"limit": ${e}, "offset": ${t}}`}).then(e=>{if(!(e.status>=400))return e.json();console.warn("fetchMessage")}).then(e=>e).catch(e=>{console.error(e)})}function fetchQrcode(){fetch("/profile/getQrcode",{method:"post",credentials:"include"}).then(e=>{if(!(e.status>=400))return e.blob();console.warn("wong (client)")}).then(e=>{document.querySelector(".qr-contain-img").src=URL.createObjectURL(e)}).catch(e=>{console.error(e)})}function updateMessage(e){if(e)for(let t=0;t<e.length;t++){let n=document.importNode(msgElement.content,!0).querySelector(".logs-item");n.querySelector(".logs-item-desc ._time").innerText=new Date(e[t].time).toLocaleTimeString("en-US",{timeZone:"Asia/Manila",hour12:!0,hour:"numeric",minute:"2-digit"}),n.querySelector(".logs-item-desc ._date").innerText=new Date(e[t].time).toLocaleDateString("en-US",{month:"long",day:"numeric"}),1==e[t].isIn?(n.querySelector(".logs-item-title span").innerText="IN",n.querySelector(".logs-item-title i").innerText="Login",n.querySelector(".logs-item-desc ._isIn").innerText="arrived"):(n.querySelector(".logs-item-title span").innerText="OUT",n.querySelector(".logs-item-title i").innerText="Logout",n.querySelector(".logs-item-desc ._isIn").innerText="left"),document.querySelector(".logs-container").appendChild(n),messageCount++}}function handleDropdown(e){"false"===e.attributes.isDropdownOpen.value?(e.setAttribute("isDropdownOpen","true"),e.nextElementSibling.querySelector("menu").style.display="inline"):"true"===e.attributes.isDropdownOpen.value&&(e.setAttribute("isDropdownOpen","false"),e.nextElementSibling.querySelector("menu").style.removeProperty("display"))}function collapseSection(e,t){e.classList.toggle("collapse"),t.classList.toggle("up"),setTimeout(()=>{},500)}fetchQrcode(),fetchMessages(10,messageCount).then(e=>{updateMessage(e)}),document.addEventListener("click",e=>{!(e.target.closest(".dropdown-contain")||e.target.closest(".dropdown-button"))&&"false"!==document.querySelector(".dropdown-button").attributes.isDropdownOpen.value&&document.querySelectorAll(".dropdown").forEach(e=>{e.querySelector(".dropdown-contain menu").style.removeProperty("display"),e.querySelector(".dropdown-button").setAttribute("isDropdownOpen","false")})}),document.querySelector(".logs-container").addEventListener("scrollend",function(){getMessageDebounce&&this.clientHeight+this.scrollTop>=this.scrollHeight-60&&(fetchMessages(5,messageCount).then(e=>{updateMessage(e)}),getMessageDebounce=!1,setTimeout(function(){getMessageDebounce=!0},500))}),dialogElements.forEach(e=>{e.addEventListener("click",t=>{let n=e.getBoundingClientRect();(t.clientX<n.left||t.clientX>n.right||t.clientY<n.top||t.clientY>n.bottom)&&e.close()})}),document.querySelector("._logout").addEventListener("click",()=>{fetch("/profile/logout",{method:"post",credentials:"include"}).then(e=>{!(e.status>=400)&&location.reload()}).catch(e=>{console.error(e)})});