let c=0;let t=true;const r=document.querySelector("main").getAttribute("data-displayName");const a=document.querySelector(".logs-container-item_template");const e=document.querySelectorAll(".viewDialog");const n=new WebSocket("ws://localhost:3000/ws");function o(t,e){if(!t||e==undefined||t>=25||e<=-1){console.log("bad data (client)");return}return fetch("profile/getMessage",{method:"post",headers:{"content-type":"application/json"},body:`{"limit": ${t}, "offset": ${e}}`}).then(t=>{if(t.status>=400){console.warn("fetchMessage");return}else{return t.json()}}).then(t=>{return t})["catch"](t=>{console.error(t)})}function u(e){if(!e)return;for(let t=0;t<e.length;t++){const n=document.importNode(a.content,true).querySelector(".logs-container-item");n.querySelector(".logs-container-item-text-date").innerText=s(e[t].time);n.querySelector(".logs-container-item-text-time").innerText=`${r} ${e[t].isIn?"arrived":"left"} at ${new Date(e[t].time).toLocaleTimeString("en-US",{timeZone:"Asia/Manila",hour12:true,hour:"numeric",minute:"2-digit"})}`;n.querySelector(".logs-container-item-img").innerText=e[t].isIn?"Login":"Logout";document.querySelector(".logs-container").appendChild(n);c++}}function s(t){const e=new Date(t);const n={weekday:"long",month:"long",day:"numeric"};if(e.getFullYear()!==(new Date).getFullYear())n.year="numeric";return e.toLocaleDateString("en-US",n).replace(","," â€¢")}function l(t){if(t.attributes.isDropdownOpen.value==="false"){t.setAttribute("isDropdownOpen","true");t.nextElementSibling.querySelector("menu").style.display="inline"}else if(t.attributes.isDropdownOpen.value==="true"){t.setAttribute("isDropdownOpen","false");t.nextElementSibling.querySelector("menu").style.removeProperty("display")}}function d(t,e){t.classList.toggle("collapse");e.classList.toggle("up")}function f(e,n){if(!("Notification"in window)){return}if(Notification.permission==="denied"||Notification.permission==="default"){Notification.requestPermission().then(t=>{if(t!=="granted"){return}new Notification(e,n)});return}new Notification(e,n)}o(20,c).then(t=>{u(t)});if(Notification.permission!=="denied"||Notification.permission==="default"){setTimeout(()=>{Notification.requestPermission()},12e4)}document.addEventListener("click",t=>{if(t.target.closest(".dropdown-contain")||t.target.closest(".dropdown-button")){return}document.querySelectorAll(".dropdown").forEach(t=>{t.querySelector(".dropdown-contain menu").style.removeProperty("display");t.querySelector(".dropdown-button").setAttribute("isDropdownOpen","false")})});document.querySelector(".logs-container").addEventListener("scrollend",function(){if(t&&this.clientHeight+this.scrollTop>=this.scrollHeight-60){o(5,c).then(t=>{u(t)});t=false;setTimeout(function(){t=true},500)}});e.forEach(n=>{n.addEventListener("click",t=>{const e=n.getBoundingClientRect();if(t.clientX<e.left||t.clientX>e.right||t.clientY<e.top||t.clientY>e.bottom)n.close()})});n.onmessage=t=>{let e;try{e=JSON.parse(t.data)}catch(o){return console.error(o)}const n=document.importNode(a.content,true).querySelector(".logs-container-item");n.querySelector(".logs-container-item-text-date").innerText=s(e[i].time);n.querySelector(".logs-container-item-text-time").innerText=`${r} ${e[i].isIn?"arrived":"left"} at ${new Date(e[i].time).toLocaleTimeString("en-US",{timeZone:"Asia/Manila",hour12:true,hour:"numeric",minute:"2-digit"})}`;n.querySelector(".logs-container-item-img").innerText=e[i].isIn?"Login":"Logout";document.querySelector(".logs-container").appendChild(n);c++};n.onerror=t=>{console.error(t)};